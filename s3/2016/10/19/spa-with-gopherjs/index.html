<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SPA with Gopherjs  &middot; Olivier Wulveryck&#39;s Tech Blog</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="How to write a Single Page Application MVC without blowing your mind with Javascript and a Framework." />

<meta name="keywords" content="javascript, jQuery, Gopherjs, SPA, WebUI, Cordova, ">

<link rel="author" href="http://plus.google.com/+olivier.wulveryck">


<meta property="og:title" content="SPA with Gopherjs  &middot; Olivier Wulveryck&#39;s Tech Blog ">
<meta property="og:site_name" content="Olivier Wulveryck&#39;s Tech Blog"/>
<meta property="og:url" content="https://blog.owulveryck.info/2016/10/19/spa-with-gopherjs/index.html" />
<meta property="og:locale" content="en-us">


<meta property="og:type" content="article" />
<meta property="og:description" content="How to write a Single Page Application MVC without blowing your mind with Javascript and a Framework."/>
<meta property="og:article:published_time" content="2016-10-19T07:24:51&#43;02:00" />
<meta property="og:article:modified_time" content="2016-10-19T07:24:51&#43;02:00" />

  
    
<meta property="og:article:tag" content="javascript">
    
<meta property="og:article:tag" content="jQuery">
    
<meta property="og:article:tag" content="Gopherjs">
    
<meta property="og:article:tag" content="SPA">
    
<meta property="og:article:tag" content="WebUI">
    
<meta property="og:article:tag" content="Cordova">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@owulveryck" />
<meta name="twitter:creator" content="@owulveryck" />
<meta name="twitter:title" content="SPA with Gopherjs" />
<meta name="twitter:description" content="How to write a Single Page Application MVC without blowing your mind with Javascript and a Framework." />
<meta name="twitter:url" content="https://blog.owulveryck.info/2016/10/19/spa-with-gopherjs/index.html" />
<meta name="twitter:domain" content="https://blog.owulveryck.info">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "SPA with Gopherjs",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+olivier.wulveryck?rel=author"
    },
    "datePublished": "2016-10-19",
    "description": "How to write a Single Page Application MVC without blowing your mind with Javascript and a Framework.",
    "wordCount":  1251 
  }
</script>



<link rel="canonical" href="https://blog.owulveryck.info/2016/10/19/spa-with-gopherjs/index.html" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://blog.owulveryck.info/touch-icon-144-precomposed.png">
<link href="https://blog.owulveryck.info/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.16" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



    <link rel="stylesheet" href="https://blog.owulveryck.info/css/theme/default.css">


<link rel="stylesheet" href="https://blog.owulveryck.info/css/font-awesome.min.css">
<link rel="stylesheet" href="https://blog.owulveryck.info/css/style.css">


  <link rel="stylesheet" href="https://blog.owulveryck.info/css/highlight/default.css">


<script type="text/x-mathjax-config"> MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}}); </script>
<script src='//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
<SCRIPT charset="utf-8" type="text/javascript" src="http://ws-eu.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&MarketPlace=FR&ID=V20070822%2FFR%2Foliwulstecblo-21%2F8005%2F9e85dd7f-4818-4a41-8970-af7c747be820"> </SCRIPT> <NOSCRIPT><A rel="nofollow" HREF="http://ws-eu.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&MarketPlace=FR&ID=V20070822%2FFR%2Foliwulstecblo-21%2F8005%2F9e85dd7f-4818-4a41-8970-af7c747be820&Operation=NoScript">Widgets Amazon.fr</A></NOSCRIPT>
</head>
<body>
    <header id="main-header">
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="https://blog.owulveryck.info">Olivier Wulveryck&#39;s Tech Blog</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
          <li>

            <a href="https://blog.owulveryck.info/about/index.html"
            >

            
                <i class="fa fa-info-circle"></i>
            
            
            About
            </a>
          </li>
          
          <li>

            <a href="https://blog.owulveryck.info/post/index.html"
             title="Show list of posts">

            
            
            Posts
            </a>
          </li>
          
          <li>

            <a href="https://blog.owulveryck.info/tags/index.html"
             title="Show list of tags">

            
            
            Tags
            </a>
          </li>
          
        </ul>
      </div>
      
    </div>
  </nav>

</header>


<div class="container">
<div class="row">

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  <div class="text-center">

    <h1>SPA with Gopherjs
</h1>

    <div class="metas">
<small>
  <i class="fa fa-calendar"></i>
  <time datetime="2016-10-19">19 Oct, 2016</time>
</small>


  <small>
    &middot; by Olivier Wulveryck
  
  &middot; Read in about 6 min
  &middot; (1251 Words)
</small>


<div class="margin-10">
  <i class="fa fa-tags"></i>
  
  <a href="https://blog.owulveryck.info/tags/javascript" class="label label-primary">javascript</a>
  
  <a href="https://blog.owulveryck.info/tags/jquery" class="label label-primary">jQuery</a>
  
  <a href="https://blog.owulveryck.info/tags/gopherjs" class="label label-primary">Gopherjs</a>
  
  <a href="https://blog.owulveryck.info/tags/spa" class="label label-primary">SPA</a>
  
  <a href="https://blog.owulveryck.info/tags/webui" class="label label-primary">WebUI</a>
  
  <a href="https://blog.owulveryck.info/tags/cordova" class="label label-primary">Cordova</a>
  


</div>
<br>
</div>

  </div>
</div>

  <div class="container content">
  

<h1 id="introduction">Introduction</h1>

<p>Single page application (SPA) are a standard when dealing with mobile apps.
Unfortunately, by now, JavaScript is the only programming language supported by a browser.</p>

<p>Therefore, to code web UI it remains a must.</p>

<h2 id="life-of-an-ex-sysadmin-who-wants-to-code-a-web-app-getting-depressed">Life of an ex sysadmin who wants to code a web app: getting depressed</h2>

<p>To make the development easier, your friend, who is &ldquo;web developer&rdquo; will recommend you to use a marvelous framework.
Depending on the orientation of the wind, the moon or its reading, he will encourage you to use <code>reactjs</code>, <code>angular</code>, <code>ember</code> or whatever exotic
tool.</p>

<p>With some recommendation from my real friends and from Google, I&rsquo;ve started an app based on <a href="http://ionicframework.com/">ionic</a> which is based on <a href="https://angularjs.org/">angular</a>.
As I did not know anything about angular, I&rsquo;ve watched a (very good) <a href="https://www.youtube.com/watch?v=i9MHigUZKEM">introduction</a> and followed the ionic tutorial.</p>

<p>So far so good&hellip;</p>

<p>Then I implemented a SSO with Facebook. I wrote a backend in <code>go</code> to handle the token generation and the used database connection.
I started to code it by hand, until a friend tells me about the angular module <a href="https://github.com/sahat/satellizer">Satellizer</a> that was suppose to handle the logic for me.
And it did&hellip;. It was suddenly automagic:</p>

<p>Everything was working on my browser. I was happy, So I decided to deploy my app on my iPhone and enjoy the power of Cordova.</p>

<p>That&rsquo;s when the headache started: There was something wrong on the mobile phone version. A bug!</p>

<p>I tried to debug it, with Xcode, with Safari&hellip; The more I was searching, the more I had to dive into the framework. Too many magic in it for
something that was, in fine, not a bug <sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup>.</p>

<p>I asked some help from a friend and his first reply was: &ldquo;which version of angular? Because in version 2 they have changed a lot of concepts&rdquo;</p>

<p>That was too much.
I considered that this world made of JavaScript, frameworks, grunt, bower, gulp, npm or whatever fancy tool was definitely not for me.
Too many work to learn something already outdated.</p>

<p>On top of that, I&rsquo;ve never been a callback man, I hate them since my X11/Motif programming course. I do like CSP!</p>

<h2 id="out-of-the-depression">Out of the depression!</h2>

<p>Ok, I abandoned those tools. But I still want to code my app, and I&rsquo;m not the kind of guy that easily give up.</p>

<p>Let&rsquo;s resume my needs:</p>

<ul>
<li>I need a MVC, because it&rsquo;s the most natural way to code web ui today</li>
<li>MVC is not framework dependent</li>
<li>A SPA is the good choice for a mobile app and Cordova makes things easy</li>
<li>Javascript is mandatory</li>
</ul>

<p>I&rsquo;ve digge a little bit and I&rsquo;ve found this blog post: <a href="https://mmikowski.github.io/no-frameworks/">Do you really want an SPA framework?</a> which leads me to &ldquo;the solution&rdquo;:</p>

<p>I will code my model/view/controller from scratch.
But as I want to preserve my health and stay away from Javacript, I will code it with something fun: go.</p>

<p>At the last doGo.eu <a href="https://twitter.com/shurcool">Dmitri Shuralyov</a> gave a very good introduction about <a href="https://github.com/gopherjs/gopherjs">gopherjs</a>. Gopherjs is a <a href="https://en.wikipedia.org/wiki/Source-to-source_compiler">transpiler</a> that converts go code into javascript.</p>

<p>You can code all your logic in go and transpile it in javascript, or you can use is to access you DOM or other javascript libraries.</p>

<p>A bunch of bindings to famous javascript libraries such as jQuery already exists on gihtub,</p>

<p>Let&rsquo;s see an example and implement a very basic routing mechanism relying on a pure js library.</p>

<h1 id="examples">Examples</h1>

<p>I will code a little page based on bootstrap.</p>

<h2 id="a-basic-go-code">A basic go code</h2>

<p>The dynamic part will be coded in pure GO in a file called <code>main.go</code> and transpiled into javscript code with the help of the <code>gopherjs</code> command:</p>

<pre><code class="language-bash">gopherjs build main.go -o js/app.js -m
</code></pre>

<p>To make things easier, I can add some directives in my go code in the form of a comment:</p>

<pre><code class="language-go">package main
//go:generate gopherjs build main.go -o js/app.js -m
// +build ignore

import (
  &quot;log&quot;
)

func main() {
    log.Println(&quot;Hello World&quot;)
}
</code></pre>

<p>Therefore I will be able to generate my code directly with a simple call to <code>go generate</code> and it will produce the <code>js/app.js</code> file for me.</p>

<h2 id="the-page">The page</h2>

<p>The structure of the main page is taken from bootstrap&rsquo;s <a href="http://getbootstrap.com/examples/starter-template/#">starter template</a></p>

<p>I simply add my javascript file generated with gopherjs :</p>

<pre><code class="language-html">&lt;script src=&quot;js/app.js&quot;&gt;&lt;/script&gt;
</code></pre>

<p>If I launch my page, I will have a &ldquo;hello world&rdquo; written in the javascript browser of my console.</p>

<h1 id="the-spa">the SPA</h1>

<p>Now, I will implement a very basic SPA.
It will display three tabs accessible by their names (for demo purpose):</p>

<ul>
<li><a href="/#">/#</a></li>
<li><a href="/#about">/#about</a></li>
<li><a href="/#contact">/#contact</a></li>
</ul>

<p>I want to trigger a javascript code that could change the content of the body by clicking on the links.</p>

<h2 id="routing">Routing</h2>

<p>A good SPA needs a good routing system to deal with anchor refs.</p>

<p>There are several implementation of gopherjs based routing mechanism.</p>

<p>But, for the purpose of this blog post, I will use a pure Javascript routing library: <a href="https://github.com/flatiron/director#routing-table">Director.js</a>. It&rsquo;s the router used in the todoMVC example and it will allow me to show how to interact with global javascript objects.</p>

<p>The first thing to do is to include the js file at the end of the <code>index.html</code></p>

<pre><code class="language-html">&lt;script src=&quot;js/director.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/app.js&quot;&gt;&lt;/script&gt;
</code></pre>

<p>Then I will create a GO type <em>Router</em> that will correspond to the Router objet in javascript.
To do so, the Router type must be a <a href="https://godoc.org/github.com/gopherjs/gopherjs/js#Object">*js.Object</a></p>

<pre><code class="language-go">import &quot;github.com/gopherjs/gopherjs/js&quot;

type Router struct {
    *js.Object
}
</code></pre>

<p>Then I define a constructor, that simply get the router object from the global scope of the javascript engine:</p>

<pre><code class="language-go">func NewRouter() *Router {
    return &amp;Router{js.Global.Get(&quot;Router&quot;).New()}
}
</code></pre>

<p>Then, to actually implement my <a href="https://github.com/flatiron/director#adhoc-routing">adhoc-routing</a> as described in the doc of director.js,
I must implement the <code>on</code> and the <code>init</code> bindings.</p>

<p>Once done, I add the routes in my <code>main</code> func:</p>

<script src="//gist.github.com/owulveryck/3256d582ad2241eeeaf118d5bf9c1cd0.js?file=router.go"></script>

<p>If I launch the page, I can now click on the links and it will diplay hello in my console.</p>

<p>You can check the full code on <a href="https://gist.github.com/owulveryck/3256d582ad2241eeeaf118d5bf9c1cd0">this gist</a></p>

<p>You see that I&rsquo;ve let the function as <code>notImplementedYet</code>, but replacing it with a jQuery call is trivial:</p>

<pre><code class="language-go">import &quot;github.com/gopherjs/jquery&quot;

//convenience:
var jQuery = jquery.NewJQuery

func content() {
    jQuery(&quot;#main&quot;).SetText(&quot;Welcome to GopherJS&quot;)
}
</code></pre>

<h1 id="conclusion">Conclusion</h1>

<p>Gopherjs is not trivial, but it has the ability to make the web development more structured.
I&rsquo;ve started a web ui from scratch and reach the same goal as the one I reached in javacript in only 2 days (compared to 3 weeks).</p>

<p>Of course, a javascript-master-of-the-world would argue that he would implement it in 2 hours, but that&rsquo;s not the point here.
The point is that I can use all the &ldquo;benefits&rdquo; of the go principles easily to write a web ui.</p>

<p>You can check the development of the <a href="https://github.com/nhite/frontend">Nhite fronted</a> to watch the progress I will make (or not) with this technology.</p>

<hr />

<p>1 - Actually, I figured out what the &ldquo;bug&rdquo; was later, when I finished the implementation in go and there was no magic anymore in the code.
The oauth2 flow I use is &ldquo;<a href="https://tools.ietf.org/html/rfc6749#section-1.3.1">Authorization code</a>&rdquo;. In this flow, you query the authorization server (here facebook) and send it the client identifier and <em>a redirection URI</em>.
In my dev environment this redirection URI is set to &ldquo;<a href="http://localhost&quot;">http://localhost&quot;</a>. Once the user is logged in (on the Facebook page), the navigation window redirects him in the application at localhost.
When running on iOS with <em>cordova</em> the files are served locally (file://,,,) and there is no way to specify a redirect URI that point to file://, therefore the redirect URI must point somewhere else&hellip; but in this case, getting the code from the application becomes tricky because of the security policies. I could do a complete blog post about this.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1"> <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
</ol>
</div>

</div>


  <footer>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      
  
    <nav><ul class="pager">
    
        <li class="previous">
          <a href="https://blog.owulveryck.info/2016/10/17/http-over-udt-for-inter-region-file-transfer/index.html" title="HTTP over UDT for inter-region file transfer">
            <span aria-hidden="true">&larr;</span>Previous
          </a>
        </li>
    

    
    </ul> </nav>
  


</div>

  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//owulveryck.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>


</div>
</div>
      <footer class="footer">
    <div class="container hidden-print">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
           <div class="pull-left">
  <a class="toplink" href="#">back to top</a>
</div>
<div class="pull-right">
  
</div>

        </div>
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
          <small>
              
    
<div class="container footline">
  

</div>


    
<div class="container copyright">
  
  All rights reserved - <sup>2015</sup>&frasl;<sub>2016</sub>


</div>



          </small>
        </div>
     </div>
    </div>
</footer>

    <script src="https://blog.owulveryck.info/js/jquery.min-2.1.4.js"></script>
<script src="https://blog.owulveryck.info/js/bootstrap.min-3.3.5.js"></script>



<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//owulveryck.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="https://blog.owulveryck.info/js/highlight.pack.js"></script>
<script src="https://blog.owulveryck.info/js/site.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>
  var _gaq=[['_setAccount','UA-69673850-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>


  </body>
</html>

