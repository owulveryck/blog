<!DOCTYPE html>
<html lang="en-us" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Behaviour Driven Development with Gherkin and Cucumber (an introduction) - Unladen swallow</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Olivier Wulveryck" /><meta name="description" content="Some notes about Behaviour driver development, gherkin and Cucumber. The example describes here will test a service on an AWS&#39;s EC2 instance." />
<meta name="keywords" content="EC2, BDD, Gherkin, Cucumber, Ruby" />







<meta name="generator" content="Hugo 0.48" />


<link rel="canonical" href="https://blog.owulveryck.info/2016/03/31/behaviour-driven-development-with-gherkin-and-cucumber-an-introduction.html" />



<link rel="icon" href="/favicon.ico" />









<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">



<link rel="stylesheet" href="/css/syntax.css">


<meta property="og:title" content="Behaviour Driven Development with Gherkin and Cucumber (an introduction)" />
<meta property="og:description" content="Some notes about Behaviour driver development, gherkin and Cucumber. The example describes here will test a service on an AWS&#39;s EC2 instance." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.owulveryck.info/2016/03/31/behaviour-driven-development-with-gherkin-and-cucumber-an-introduction.html" /><meta property="article:published_time" content="2016-03-31T23:39:35&#43;01:00"/>
<meta property="article:modified_time" content="2016-03-31T23:39:35&#43;01:00"/>
<meta itemprop="name" content="Behaviour Driven Development with Gherkin and Cucumber (an introduction)">
<meta itemprop="description" content="Some notes about Behaviour driver development, gherkin and Cucumber. The example describes here will test a service on an AWS&#39;s EC2 instance.">


<meta itemprop="datePublished" content="2016-03-31T23:39:35&#43;01:00" />
<meta itemprop="dateModified" content="2016-03-31T23:39:35&#43;01:00" />
<meta itemprop="wordCount" content="2337">



<meta itemprop="keywords" content="EC2,BDD,Gherkin,Cucumber,Ruby," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Behaviour Driven Development with Gherkin and Cucumber (an introduction)"/>
<meta name="twitter:description" content="Some notes about Behaviour driver development, gherkin and Cucumber. The example describes here will test a service on an AWS&#39;s EC2 instance."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-69673850-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


       <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Droid Sans" type="text/css" media="all" />
     
       <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fira Mono" type="text/css" media="all" />
     

 <style>
 body {
     font-family: 'Droid Sans';
 }
 code {
    font-family: 'Fira Mono';
 }
 </style>




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Unladen swallow</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://about.me/owulveryck" rel="noopener" target="_blank">
              About the Author
              <i class="iconfont icon-new-window"></i>
            </a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.owulveryck.info/">Home</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Unladen swallow
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://about.me/owulveryck" rel="noopener" target="_blank">
              About the Author
            <i class="iconfont icon-new-window"></i>
            </a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://blog.owulveryck.info/">Home</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Behaviour Driven Development with Gherkin and Cucumber (an introduction)</h1>
      
      <div class="post-meta">
        <span class="post-time"> 2016-03-31 </span>
        
        <span class="more-meta"> 2337 words </span>
          <span class="more-meta"> 11 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#opening-remarks">Opening remarks</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#gherkin">Gherkin</a></li>
<li><a href="#and-here-comes-cucumber">And here comes Cucumber</a></li>
</ul></li>
<li><a href="#let-s-play">Let&rsquo;s play</a>
<ul>
<li><a href="#the-scenario">The scenario</a>
<ul>
<li>
<ul>
<li><a href="#the-customer-point-of-view">The customer point of view</a></li>
<li><a href="#the-architect-point-of-view">The architect point of view</a></li>
<li><a href="#the-developer-point-of-view">The developer point of view</a></li>
</ul></li>
</ul></li>
<li><a href="#the-basic-feature">The basic <em>feature</em></a></li>
<li><a href="#setting-up-the-ruby-environment">Setting up the Ruby environment</a>
<ul>
<li>
<ul>
<li><a href="#the-test-environment-with-bundler">The test environment with bundler</a></li>
<li><a href="#the-gemfile">the <em>Gemfile</em></a></li>
</ul></li>
<li><a href="#the-skeleton-of-the-test">The skeleton of the test</a>
<ul>
<li><a href="#adding-the-feature-file">Adding the <em>feature</em> file</a></li>
<li><a href="#implementation-of-the-given-keywords">Implementation of the &ldquo;Given&rdquo; keywords</a></li>
<li><a href="#implementation-of-the-when-keyword">Implementation of the &ldquo;When&rdquo; keyword</a></li>
<li><a href="#trying-to-implement-the-netflix-test-with-selenium">(trying to) Implement the netflix test with selenium</a></li>
</ul></li>
<li><a href="#the-actual-implementation-of-the-scenario">The actual implementation of the scenario</a>
<ul>
<li><a href="#installing-vagrant-aws-plugin">Installing vagrant-aws plugin</a></li>
<li><a href="#installing-the-base-box">Installing the base box</a></li>
<li><a href="#the-vagrantfile">The Vagrantfile</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<h4 id="opening-remarks">Opening remarks</h4>

<p>All my previous posts were about choreography, deployment, topology, and more recently about an attempt to include <em>AI</em> in those systems.
This post is a bit apart, because I&rsquo;m facing a new challenge in my job which is to implement BDD in a <em>CI</em> chain. Therefore, I&rsquo;m using
this blog as a reminder of what I did personally. The following of the <em>Markov</em> saga will come again later.</p>

<h1 id="introduction">Introduction</h1>

<p>Wikipedia defines the word contract like this:</p>

<blockquote>
<p>A contract is a voluntary arrangement between two or more parties that is enforceable at law as a binding legal agreement.</p>
</blockquote>

<p>If law usually describes what you can and cannot do, a contract is more likely to describe what&rsquo;s you are expected to do.</p>

<p>A law&rsquo;s goal is not only to give rules to follow,
but also to maintain a stability in an ecosystem.
In IT there are laws, that may be implicit, didactic, empiric, &hellip; but the IT with all its laws should not
dictate the expected behavior of the customer. But how often have you heard:</p>

<blockquote>
<p>&ldquo;those computer stuffs are not for me, just get the thing done&rdquo;</p>

<p>&ldquo;we&rsquo;ve always done it this way&rdquo;</p>
</blockquote>

<p>There are laws that cannot be changed, but the contract between a customer and its provider could and should evolve.</p>

<p>In IT, like everywhere else where a customer/provider relationship exists, a special need is formalized via specifications.
Specifications are hard to follow, but even more they&rsquo;re hard to evaluate.</p>

<p><center>
<img src="http://imgs.xkcd.com/comics/babies.png" alt="Babies (xkcd)" />
</center></p>

<p>The <strong>B</strong>ehavior <strong>D</strong>riven <strong>D</strong>evelopment is the assurance that everything have been made respectfully i
with the contract ²that has been established between the parties (customers and providers).
To do things right, this contract should be established at the very beginning.</p>

<p>Hence, every single item must be developed with all the <em>features</em> of the contract in mind. And then, it should be
possible to use automation to perform the tests of behaviour, so that the developer can see if the contract is fulfilled, and if, for
example, no regression has been introduced.</p>

<p>In a continuous integration chain, this is an essential piece that can be use to fully automate the process of delivery.</p>

<h2 id="gherkin">Gherkin</h2>

<p>To express the specification in a way that can be both human and computer readable, the easiest way is to use a special dedicated
language.</p>

<p>Such a language is known as <a href="https://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> ( Domain Specific Language).</p>

<p><a href="https://github.com/cucumber/cucumber/wiki/Gherkin">Gherkin</a> is a DSL that <em>lets you describe software&rsquo;s behaviour without dealing how that behaviour
is implemented</em></p>

<p>The behaviour is a scenario detailed as a set of <em>features</em>. A feature is a human readable English
(or another human language among 37 implemented languages) text file with a bunch of key words in it (eg: <strong>Given</strong>, <strong>And</strong>, <strong>When</strong>, <strong>Then</strong>,&hellip;).
Those words do not only help the writer of the feature to organize its idea, but they are used by the Gherkin processor to localize the
test of the feature in the code. Of course, there is no magic in it: the test must have been implemented manually.</p>

<h2 id="and-here-comes-cucumber">And here comes Cucumber</h2>

<p>The historic Gherkin processor is called Cucumber. It&rsquo;s a Ruby implementation of the Gherkin DSL.
Its purpose is to read a scenario, and to localize the Ruby code that is implementing the all the tests corresponding to the scenario.
Finally it executes the code, and for each feature it simply says ok or ko.</p>

<p>Easy.</p>

<p>Nowadays there are many implementation of Gherkin parser for different languages, but in this post I will stick to the Cucumber.</p>

<h1 id="let-s-play">Let&rsquo;s play</h1>

<p>Let&rsquo;s see how we can implement a basic behaviour driver development with the help of cucumber and Ruby.
The idea here is not to test a Ruby development, but instead to use ruby to validate a shell script.
That&rsquo;s the main reason why I stick to Ruby (instead of GO which I know better). The Go implementation
(<a href="https://github.com/DATA-DOG/godog">GoDoc</a>, <a href="https://github.com/smartystreets/goconvey">GoConvey</a>, &hellip;) relies
on <code>go test</code> and therefore are related to a pure GO development.
Of course I could do a complete GO development to encapsulate my scripts, but that&rsquo;s not the point; for my purpose, a scripting
language is a better choice.</p>

<p>Ruby is a scripting language and all the tests implemented here are neither dependent on the Ruby test framework nor on <a href="http://rspec.info/">RSpec</a>.</p>

<p>I will write a script that will deploy an EC2 instance via vagrant-aws and install an Openvpn instance on it.</p>

<h2 id="the-scenario">The scenario</h2>

<h4 id="the-customer-point-of-view">The customer point of view</h4>

<p>With my role of customer, the feature I&rsquo;m expecting is:</p>

<ul>
<li>Given the execution of the program, and waiting for it to be successful</li>
<li>Then I may be able to watch netflix US from France.</li>
</ul>

<p>The feature may be:</p>
<div class="highlight"><pre class="chroma"><code class="language-gherkin" data-lang="gherkin">Feature: I want a program that
  will simply allows me to watch netflix US

  Scenario: I want to watch netflix
     Given I am on my chromebook
     And I have access to the shell
     When I want to watch netflix
     And I launch a program from the command line
     And it displays ready
     Then I open a navigator windows on http://www.netflix.com
     And I can watch Grey&#39;s anatomy (which is not available in france)</code></pre></div>
<h4 id="the-architect-point-of-view">The architect point of view</h4>

<p>As an architect the implementation I&rsquo;m thinking of is</p>

<ul>
<li>start an EC2 instance (I will not create it in this post)</li>
<li>register it to my DNS (with blog-test.owulveryck.info)</li>
<li>install Openvpn</li>
<li>configure Openvpn to make it accessible via blog-test.owulveryck.info</li>
</ul>

<h4 id="the-developer-point-of-view">The developer point of view</h4>

<p>And as a developer, I&rsquo;m thinking about using <a href="https://github.com/mitchellh/vagrant-aws">vagrant-aws</a> to perform the tasks.
All the implementation will be based on a Vagrant file and a provisioning script.
The vagrant file will be evaluated by <code>vagrant up</code> on CLI (aka in the real world, by the end user) and
the same vagrant file will be evaluated within my cucumber scripts.</p>

<p><strong>Therefore I can say that I am doing BDD/TDD for a configuration management and provisioning.</strong></p>

<h2 id="the-basic-feature">The basic <em>feature</em></h2>

<p>I will describe here a single feature, just for testing purpose.</p>

<h2 id="setting-up-the-ruby-environment">Setting up the Ruby environment</h2>

<p>I will use the <em>Ruby</em> implementation of cucumber.
To install it, assuming that we have a <code>gem</code> installed, just run this command</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"># gem install cucumber</code></pre></div>
<p>This will load all the required dependencies.
It may also be a good idea to use <code>bundle</code> if we plan to do further development of the steps in ruby.</p>

<h4 id="the-test-environment-with-bundler">The test environment with bundler</h4>

<p>The whole development will run with the help of bundler (and RVM).
See this <a href="http://dev.owulveryck.info/2016/03/31/rvm-from-a-usb-stick-on-a-chromebook/">post</a> for more explanation on
how I set it up on my Chromebook.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">&gt; mkdir /media/removable/Lexar/tools/vpn-blog
&gt; <span class="nb">cd</span> /media/removable/Lexar/tools/vpn-blog
&gt; rvmrc --create <span class="m">2</span>.2.0@vpn-blog
&gt; <span class="nb">source</span> .rvmrc
&gt; gem install bundler -v <span class="m">1</span>.5.2 
&gt; bundle init
Writing new Gemfile to /home/chronos/user/gherkin/Gemfile</code></pre></div>
<h4 id="the-gemfile">the <em>Gemfile</em></h4>

<p>Let&rsquo;s add the cucumber, vagrant (as installed in a previous <a href="http://dev.owulveryck.info/2016/03/31/rvm-from-a-usb-stick-on-a-chromebook/">post</a> ),
and vagrant-aws dependencies in the Gemfile:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">&gt; cat Gemfile
<span class="nb">source</span> <span class="s2">&#34;https://rubygems.org&#34;</span>

gem <span class="s2">&#34;vagrant&#34;</span>, :path <span class="o">=</span>&gt; <span class="s2">&#34;/media/removable/Lexar/tools/vagrant&#34;</span>
gem <span class="s2">&#34;vagrant-aws&#34;</span>
gem <span class="s2">&#34;bundler&#34;</span>, <span class="s2">&#34;1.5.2&#34;</span>
gem <span class="s2">&#34;cucumber&#34;</span></code></pre></div>
<p>and then <em>install</em> the bundle:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">&gt; bundle _1.5.2_ install
Resolving dependencies...
Using builder <span class="m">3</span>.2.2
Using gherkin <span class="m">3</span>.2.0
Using cucumber-wire <span class="m">0</span>.0.1
Using diff-lcs <span class="m">1</span>.2.4
Using multi_json <span class="m">1</span>.7.9
Using multi_test <span class="m">0</span>.1.2
Using bundler <span class="m">1</span>.11.2
Using cucumber-core <span class="m">1</span>.4.0
Using cucumber <span class="m">2</span>.3.3
...
Bundle complete! <span class="m">1</span> Gemfile dependency, <span class="m">9</span> gems now installed.
Use <span class="sb">`</span>bundle show <span class="o">[</span>gemname<span class="o">]</span><span class="sb">`</span> to see where a bundled gem is installed.</code></pre></div>
<p>And now let&rsquo;s run cucumber within the bundle:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">&gt; bundle _1.5.2_ <span class="nb">exec</span> cucumber
No such file or directory - features. You can use <span class="sb">`</span>cucumber --init<span class="sb">`</span> to get started.</code></pre></div>
<h3 id="the-skeleton-of-the-test">The skeleton of the test</h3>

<p>First, as requested by cucumber, let&rsquo;s initialize a couple of files in the directory to be &ldquo;cucumber compliant&rdquo;.
Cucumber do have a helpful <em>init</em> function. Let&rsquo;s run it now:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">bundle _1.5.2_ <span class="nb">exec</span> cucumber --init
  create   features
  create   features/step_definitions
  create   features/support
  create   features/support/env.rb</code></pre></div>
<h4 id="adding-the-feature-file">Adding the <em>feature</em> file</h4>

<p>In the <em>features/</em> directory, I create a file <code>basic_feature.feature</code> which contains the YAML we wrote earlier, then I run cucumber again.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ bundle _1.5.2_ <span class="nb">exec</span> cucumber
Feature: I want a program that
  will simply allows me to watch netflix US
  
  Scenario: I want to watch netflix                                   <span class="c1"># features/basic_feature.feature:4
</span><span class="c1"></span>    Given I am on my chromebook                                       <span class="c1"># features/basic_feature.feature:5
</span><span class="c1"></span>    And I have access to the shell                                    <span class="c1"># features/basic_feature.feature:6
</span><span class="c1"></span>    When I want to watch netflix                                      <span class="c1"># features/basic_feature.feature:7
</span><span class="c1"></span>    And I launch a program on the <span class="nb">command</span> line                        <span class="c1"># features/basic_feature.feature:8
</span><span class="c1"></span>    And it displays ready                                             <span class="c1"># features/basic_feature.feature:9
</span><span class="c1"></span>    Then I open a navigator windows on http://www.netflix.com         <span class="c1"># features/basic_feature.feature:10
</span><span class="c1"></span>    And I can watch Grey<span class="err">&#39;</span>s anatomy <span class="o">(</span>which is not available in france<span class="o">)</span> <span class="c1"># features/basic_feature.feature:11
</span><span class="c1"></span>                                
<span class="m">1</span> scenario <span class="o">(</span><span class="m">1</span> undefined<span class="o">)</span>
<span class="m">7</span> steps <span class="o">(</span><span class="m">7</span> undefined<span class="o">)</span>
0m0.054s

You can implement step definitions <span class="k">for</span> undefined steps with these snippets:

Given<span class="o">(</span>/^I am on my chromebook$/<span class="o">)</span> <span class="k">do</span>
  pending <span class="c1"># Write code here that turns the phrase above into concrete actions
</span><span class="c1"></span>end
...</code></pre></div>
<p>We notice that the feature has been read and understood correctly by cucumber.
ON top of that Cucumber gives the skeleton of a ruby implementation for the tests.</p>

<p>I will copy all the ruby code in its own file:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># cat &gt; features/step_definitions/tests.rb</span>
<span class="no">Given</span><span class="p">(</span><span class="sr">/^I am on my chromebook$/</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">pending</span> <span class="c1"># Write code here that turns the phrase above into concrete actions</span>
  <span class="k">end</span>
<span class="o">...</span></code></pre></div>
<p>And run cucumber once more:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">Feature: I want a program that
  will simply allows me to watch netflix US

  Scenario: I want to watch netflix                                   <span class="c1"># features/basic_feature.feature:4
</span><span class="c1"></span>      Given I am on my chromebook                                       <span class="c1"># features/step_definitions/tests.rb:1
</span><span class="c1"></span>        TODO <span class="o">(</span>Cucumber::Pending<span class="o">)</span>
        ./features/step_definitions/tests.rb:2:in <span class="sb">`</span>/^I am on my chromebook$/<span class="s1">&#39;
</span><span class="s1">        features/basic_feature.feature:5:in `Given I am on my chromebook&#39;</span>
      And I have access to the shell                                    <span class="c1"># features/step_definitions/tests.rb:5
</span><span class="c1"></span>      When I want to watch netflix                                      <span class="c1"># features/step_definitions/tests.rb:9
</span><span class="c1"></span>      And I launch gonetflix.sh                                         <span class="c1"># features/step_definitions/tests.rb:13
</span><span class="c1"></span>      And it displays ready                                             <span class="c1"># features/step_definitions/tests.rb:17
</span><span class="c1"></span>      Then I open a navigator windows on http://www.netflix.com         <span class="c1"># features/step_definitions/tests.rb:21
</span><span class="c1"></span>      And I can watch Grey<span class="err">&#39;</span>s anatomy <span class="o">(</span>which is not available in france<span class="o">)</span> <span class="c1"># features/step_definitions/tests.rb:25
</span><span class="c1"></span>      
<span class="m">1</span> scenario <span class="o">(</span><span class="m">1</span> pending<span class="o">)</span>
<span class="m">7</span> steps <span class="o">(</span><span class="m">6</span> skipped, <span class="m">1</span> pending<span class="o">)</span>
0m0.041s<span class="sb">`</span></code></pre></div>
<p>Cool, the framework is ok. Now let&rsquo;s actually implement the scenario and the tests</p>

<h4 id="implementation-of-the-given-keywords">Implementation of the &ldquo;Given&rdquo; keywords</h4>

<p>There is not much to say about the Given keyword. I can test that I am really on my Chromebook but that does not make any sense.
I will skip this test by not implementing anything in the function.</p>

<h4 id="implementation-of-the-when-keyword">Implementation of the &ldquo;When&rdquo; keyword</h4>

<p>The actual execution of the &ldquo;When&rdquo; is the execution of the Vagrant file.
It will start the EC2 instance and provision the VPN
I also need to mount the VPN locally afterwards</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="ch">#!/usr/bin/env ruby</span>
<span class="nb">require</span> <span class="s2">&#34;vagrant&#34;</span>

<span class="c1"># Starting the EC2 instance (running the vagrantfile)</span>
<span class="n">env</span> <span class="o">=</span> <span class="no">Vagrant</span><span class="o">::</span><span class="no">Environment</span><span class="o">.</span><span class="n">new</span>
<span class="n">env</span><span class="o">.</span><span class="n">cli</span><span class="p">(</span><span class="s2">&#34;up&#34;</span><span class="p">)</span>
<span class="c1"># Starting OpenVPN locally</span>
<span class="sb">`sudo openvpn --mktun --dev tun0 &amp;&amp; sudo openvpn --config ~/Downloads/client.ovpn --dev tun0`</span></code></pre></div>
<h4 id="trying-to-implement-the-netflix-test-with-selenium">(trying to) Implement the netflix test with selenium</h4>

<p>To test the access, instead of faking my browser with curl, I will use the <em>selenium</em> tool.
So I add it to my <em>Gemfile</em> and <code>bundle update</code> it (informations comes from <a href="https://github.com/jonathanchrisp/selenium-cucumber-ruby-kickstarter">this starterkit</a>):</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ <span class="nb">echo</span> <span class="s1">&#39;gem &#34;selenium-cucumber&#34;&#39;</span> &gt;&gt; Gemfile
$ <span class="nb">echo</span> <span class="s1">&#39;gem &#34;selenium-webdriver&#34;&#39;</span> &gt;&gt; Gemfile
$ <span class="nb">echo</span> <span class="s1">&#39;gem &#34;require_all&#34;&#39;</span> &gt;&gt; Gemfile
$ bundle _1.5.2_ update </code></pre></div>
<p>Then I need to create a special file in the <code>support</code> subdirectory to define a bunch of objects:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="c1"># cat features/support/env.rb</span>
<span class="nb">require</span> <span class="s1">&#39;selenium-webdriver&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;cucumber&#39;</span>

<span class="nb">require</span> <span class="s1">&#39;require_all&#39;</span>

<span class="n">require_all</span> <span class="s1">&#39;lib&#39;</span>

<span class="no">Before</span> <span class="k">do</span> <span class="o">|</span><span class="n">scenario</span><span class="o">|</span>
    <span class="vi">@browser</span> <span class="o">=</span> <span class="no">Browser</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;DRIVER&#39;</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@browser</span><span class="o">.</span><span class="n">delete_cookies</span>
<span class="k">end</span>

<span class="no">After</span> <span class="k">do</span> <span class="o">|</span><span class="n">scenario</span><span class="o">|</span>
    <span class="vi">@browser</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span></code></pre></div>
<p>I&rsquo;m also adding the files from the starterkit in the <code>lib</code> subdirectory.</p>

<p>As I am developing on my Chromebook, I also need the <a href="https://sites.google.com/a/chromium.org/chromedriver/">chromedriver</a></p>

<p><strong>Too bad</strong> chromedriver relies on the libX11 that cannot be installed on my Chromebook / <strong>end of show for selenium</strong>
on the Chromebook&hellip;  for now</p>

<p><em>Note</em> I will continue with the development, but be aware that I won&rsquo;t be able to test it until I am on a true linux box with
the chromedriver installed</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="no">Then</span><span class="p">(</span><span class="sr">/^I open a navigator windows on (.*?)$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">arg1</span><span class="o">|</span>
  <span class="vi">@browser</span><span class="o">.</span><span class="n">open_page</span><span class="p">(</span><span class="s2">&#34;http://www.netflix.com&#34;</span><span class="p">)</span>
<span class="k">end</span>

<span class="no">Then</span><span class="p">(</span><span class="sr">/^I can watch Grey&#39;s anatomy \(which is not available in france\)$/</span><span class="p">)</span> <span class="k">do</span>
  <span class="vi">@browser</span><span class="o">.</span><span class="n">open_page</span><span class="p">(</span><span class="s2">&#34;http://www.netflix.com/idtogreysanatomy&#34;</span><span class="p">)</span>
<span class="k">end</span></code></pre></div>
<h3 id="the-actual-implementation-of-the-scenario">The actual implementation of the scenario</h3>

<p>What I need to do is to implement the scenario. Not the test scenario, the real one;
the one that will actually allows me to launch my ec2 instance, configure and start Openvpn.</p>

<p>As I said before, I will use vagrant-aws to do so.</p>

<p><strong>Note</strong> vagrant was depending on <em>bsdtar</em>, and I&rsquo;ve had to install it manually from source:</p>

<p>(<code>tar xzvf libarchive-3.1.2.tar.gz &amp;&amp; ... &amp;&amp; ./configure --prefix=/usr/local &amp;&amp; make install clean</code>)</p>

<h4 id="installing-vagrant-aws-plugin">Installing vagrant-aws plugin</h4>

<p>The vagrant-aws plugin has been installed by the bundler because I&rsquo;ve indicated it as a dependency in the Gemfile.
But, I will have to have it as a requirement in the Vagrantfile because I&rsquo;m not using the &ldquo;official vagrant&rdquo; and that
I am running in a bundler environment:</p>

<blockquote>
<p>Vagrant&rsquo;s built-in bundler management mechanism is disabled because
Vagrant is running in an external bundler environment. In these
cases, plugin management does not work with Vagrant. To install
plugins, use your own Gemfile. To load plugins, either put the
plugins in the <code>plugins</code> group in your Gemfile or manually require
them in a Vagrantfile.</p>
</blockquote>

<h4 id="installing-the-base-box">Installing the base box</h4>

<p>The documentation says that the quickest way to get started is to install the dummy box.
That&rsquo;s what I did:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ bundle _1.5.2_ <span class="nb">exec</span> vagrant box add dummy https://github.com/mitchellh/vagrant-aws/raw/master/dummy.box
...
<span class="o">==</span>&gt; box: Successfully added box <span class="s1">&#39;dummy&#39;</span> <span class="o">(</span>v0<span class="o">)</span> <span class="k">for</span> <span class="s1">&#39;aws&#39;</span>!</code></pre></div>
<h4 id="the-vagrantfile">The Vagrantfile</h4>

<p>The initial Vagrantfile looks like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">&#34;vagrant-aws&#34;</span>
<span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&#34;2&#34;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&#34;dummy&#34;</span>

  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="ss">:aws</span> <span class="k">do</span> <span class="o">|</span><span class="n">aws</span><span class="p">,</span> <span class="n">override</span><span class="o">|</span>
    <span class="n">aws</span><span class="o">.</span><span class="n">access_key_id</span> <span class="o">=</span> <span class="s2">&#34;YOUR KEY&#34;</span>
    <span class="n">aws</span><span class="o">.</span><span class="n">secret_access_key</span> <span class="o">=</span> <span class="s2">&#34;YOUR SECRET KEY&#34;</span>
    <span class="n">aws</span><span class="o">.</span><span class="n">session_token</span> <span class="o">=</span> <span class="s2">&#34;SESSION TOKEN&#34;</span>
    <span class="n">aws</span><span class="o">.</span><span class="n">keypair_name</span> <span class="o">=</span> <span class="s2">&#34;KEYPAIR NAME&#34;</span>

    <span class="n">aws</span><span class="o">.</span><span class="n">ami</span> <span class="o">=</span> <span class="s2">&#34;ami-7747d01e&#34;</span>

    <span class="n">override</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s2">&#34;ubuntu&#34;</span>
    <span class="n">override</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">private_key_path</span> <span class="o">=</span> <span class="s2">&#34;PATH TO YOUR PRIVATE KEY&#34;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
<p>So all the rest in the basic implementation of the vagrant file and the provisioning.sh for the Openvpn configuration.
but that goes far behind the topic of this post which was to introduce myself to BDD and TDD.</p>

<h1 id="conclusion">Conclusion</h1>

<p>I&rsquo;ve learned a lot about the ruby and cucumber environment in this post.
Too bad I couldn&rsquo;t end with a fully running example because of my Chromebook.</p>

<p>Anyway the expected results were for me to:</p>

<ul>
<li>learn about BDD</li>
<li>learn about cucumber</li>
<li>learn about Ruby</li>
<li>learn about vagrant</li>
</ul>

<p>I can say that I&rsquo;ve reach my goals anyway. I will try to finish the implementation on a true Linux box locally, or on my
Macbook if I have time to do so.</p>

    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://blog.owulveryck.info/tags/ec2.html">EC2</a>
          <a href="https://blog.owulveryck.info/tags/bdd.html">BDD</a>
          <a href="https://blog.owulveryck.info/tags/gherkin.html">Gherkin</a>
          <a href="https://blog.owulveryck.info/tags/cucumber.html">Cucumber</a>
          <a href="https://blog.owulveryck.info/tags/ruby.html">Ruby</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/2016/04/25/dotscale2016.html">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">dotscale2016</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/2016/03/31/rvm-from-a-usb-stick-on-a-chromebook.html">
            <span class="next-text nav-default">RVM from a USB stick on a Chromebook</span>
            <span class="prev-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    Show Disqus Comments
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://blog.owulveryck.info/2016/03/31/behaviour-driven-development-with-gherkin-and-cucumber-an-introduction.html";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'owulveryck';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/owulveryck" rel="me noopener" class="iconfont icon-twitter"
        title="twitter" target="_blank">
      </a>
      <a href="owulveryck" rel="me noopener" class="iconfont icon-itter"
        title="itter" target="_blank">
      </a>
  <a href="https://blog.owulveryck.info/index.xml" rel="noopener alternate" type="application/rss&#43;xml" class="iconfont icon-rss"
    title="rss" target="_blank">
  </a>
  </div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2015 -
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span><span class="author">
        All rights reserved
        
      </span></span>

  
  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>





  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  











</body>
</html>
